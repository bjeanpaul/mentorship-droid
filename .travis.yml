language: android
env:
  global:
    secure: b9QYFLrBMuEtRt1WMretxwYUofA1qPoFCa6Ckd2I+Fxgbr/ozQKzYS76iGicYzV5pOblQVo1Kx3HpUcxY5R/+Str68ejLgAVinQ+RQPwC+8KFKBf9UI8WUMPMEECx+WcVFRzZz9sUivRyqP5cIzxoP9GsqpaXDsWjueHnveqsd1q2yeLrZSEizDWfRsnYlkRKapIRN55Tyq2V3MB1nilYc9Z3DcdiiLt4UkPOiNsjHKhdKgHkkjKviMbAUwMuFfBSt055ABS8BNAvbit4Jp7QhZsRVszP+byboOv1FYK6pFc7et0KgP8bUBbV1nQP6LAPRoWpTmtceM4Q+efYKp/Rw5pxPv9yx/Uc6oztJihKTSt7gPr8eDJeyU2pnUZMobqJJMBW1gfeCGHdRZc6SrHU8poTTSh61KMfhfUZO60th0HRClkR57CWBnXyevzXtH5dTqVItSukMOjJPe0SleriEtmMEvqM8FA+4wSCO92M1rCWx/CgTtYh4HqS7YVuMzC0c6gnhTYdhwcP1xhhb2ou6Q11iJBmImOJZ14e34KJ6KQpMbtwvLyFmuZZzpcNrzTaFwxZZcIX6LOAj3f0yq1QT2DufXb93ADahsosyFazZtYnBjgufLNoUW3+HFCYb9DcujP2KlRq95DMGDdjfrWwyu+bxtdOfrhKSajrY03fSs=
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - node_modules
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
before_install:
- openssl aes-256-cbc -K $encrypted_0d629920e50c_key -iv $encrypted_0d629920e50c_iv
  -in secrets.tar.enc -out secrets.tar -d
- tar xvf secrets.tar
- nvm install 6
- node --version
install:
- npm install
android:
  components:
  - build-tools-23.0.1
  - android-23
  - extra-android-m2repository
  - extra-google-google_play_services
  - extra-google-m2repository
  - addon-google_apis-google-16
script:
- npm run ci
- '[ -z "$TRAVIS_TAG" ] || ./utils/travis-release.sh'
deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: Fyk/c5dWqX/qzjXRnnJLItYLAfICjY2kvZ1bIHcD7QmGy46w/8779aWcS7j/LhfNZzair6fg1rOz+2c1nnjIOuBNOnxBncduo+IsNX1uh+xSB9ljGDLsAudwLGQZvg0GWJzseFwSSZlyDjPCQvFGXldPNnmQVAwZwRdrd1Q181vTYnOyPx/ujp6m/xHeTMZNUSXjbnSUhLe3GLMQ/kHKDcYH5TR42Nn2R9F0Elz2T+tqGzaMs08jeDoEYvCwaW7gjowCz0U+S+0qyoGmtkiiNYie9nGT6lkT6mI90UcHeWKdYqPMjpXY0WXznOa5qtvXf+gV1r2jWhlP49hnD3RhdkNx2mzMEo3A0d1qwiIjgCVhuaxdwH0mHcB3pHIdTal2MOGQYxKM4DDMggMKdHXBA9d8HlKMx8nFmtoXe8xZYH0E+OeXOPXZ0bt+5VuWXZyIHCwtGMi+kZrEe/ckIDGDFIOlDPQhyVdrup186lIJ02TjSs66yA7Fz3I9sJ5cl/e5rpNFuCUlqKGzCU/BXWTDzYbSuAloKuL9l2QAFsJrl8fGHb91Fhvfb9k7E/xIOGbpt5XtuLq0A0JH5zICWMNvQvXy+Hqr/Z9VKG+QFGzWaY4cIbig7zkEBnMTW1ehJ8h1eHUB6VSvgjKCUujUV69qaA2vgtbb25vsP6aB5aoQ0xk=
  file:
  - $TRAVIS_BUILD_DIR/$TRAVIS_TAG.apk
  - $TRAVIS_BUILD_DIR/$TRAVIS_TAG.qa.apk
  on:
    repo: praekeltfoundation/mentorship-droid
    tags: true
