language: android
env:
  global:
  - secure: aa+l6Tqs2AYUw3QCRuxl33DwzHpDdeLBZ4zBKjL7NlUxyVsgJUaknum45VedYHOCNHeCLrSvpYjDIut21CVT9WxOjHcWGUqEEAOpxS15hsOLzhUNQBQCvupaLeLdfmfTmTwUnOzMPzMORv/iNqxvTu+qwRlzccZ/bBf8YWnWPvfxyW429f8VfWWuq85QW+sw50Pdtm2CHZeHU0pyGtanK6zG+B99RdILwxbr2BMFLJ0inLYrE1S79VvuLTF7NKt7DxtyNwqKdEM8HdFHUurMezSDApv7EUTt3jhxC22hbL+oFit04t9RHKWQxUMBzpOlurciIg8HFFRa3UQ/50AECsb6WpPHgAKFPXeVMQLntR7aVguV94IEVF21Qyt1Clh3SVRVDI9GP2Bs3c68zE1LrJ0YjOaeKEqtW+fvSGE5AaMoYcChOfQP1pw1b6wE8KKzVdB52kbS2sn913ngxe7+w5WraoVSX+qG6x2qziTsf+TRRP/vnWHlrpUXEvf7ZONsJqb7LrA0zQ6/oY5VM9pviw6+mlLXnliUksEej+55Zmwk3tnklyullWmqDc3w3+14bCvhdrwA/MVvp92vGzphXOIPd2BPVo4ZiWah8+C161PfTndSFr0ZVKH72fmdCvkt3E2VMhbKRg6oM7FRqoyPT2036lXs0srmkHTlovBt9mU=
  - secure: k619g/6l26jdAO2fiUxbMDKrz3mbg6khUjrhKr+HNZO5nhwbz1C8EQpB39dYs/qyXBhE7OBdgZI9lTRdPKi3Wo3/HEB2p/pt+wdzNf6WQ2t4V1lfFpSrYJlMcna12NNHUGesu3UjIpqfIY8QTsAfz5Ska8RhqtnjLf87bdO8OchFslLffIlImyfXb5iGhlnvAfnZql0f1mIEIwqU9BOYDadpotYMFii1jxv1Ei60lNi6cRTjE+GNeWOCJ7LkXxW7GxaBV7fPlYa2TG4W5HNGAqWICcUqYmyX89ZP9dibeKec2BTVTgLT4zTWaKaQRpT6j+HZN5fscsIBfWIQuO4U36qVdejkXVhf6G9plgCk4s0ox5l7ksRQzLhhR5aXBB8oXKW2cpRz3qww/4Fyar1hvNaTJ2mjAHZu4R6yv+8C3xdYtjiSw6aRIPNe/zreVSwfekGzTnvNkob8Vdn695RoKKcNpfeWP7u7cDKcBGz04hRC39Gw1jYlf0B7OIZbfDqtbTZuBEYtXDmXMdtJAUj80lQTc2QVEhdY34baDIeXcNaoWrT22XbKgqEx37DasZmQ3T7RVLGau8gN1LYqLeXU12CNJc9Ly6tB2WyGR7FEVN71EQJwvpm0w9aah0LqP3mq/5BipgvKD3V+9SpFepOtTBoKdQjEWyTTsy/si/GGxKI=
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - node_modules
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
before_install:
- openssl aes-256-cbc -K $encrypted_0d629920e50c_key -iv $encrypted_0d629920e50c_iv
  -in secrets.tar.enc -out secrets.tar -d
- tar xvf secrets.tar
- nvm install 6
- node --version
install:
- npm install
android:
  components:
  - build-tools-23.0.1
  - android-23
  - extra-android-m2repository
  - extra-google-google_play_services
  - extra-google-m2repository
  - addon-google_apis-google-16
script:
- npm run ci
- '[ -z "$TRAVIS_TAG" ] || ./utils/travis-release.sh'
deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: K8QH/FSzPwOpv80XqVyn74XJ/e81qAc16KQfNl28KRqDdRVCQd4IXA8K0JwMbw7H2Tn72U3MgUdErVsjV4ORziBUhsbLQ9fkMTHvhNZrwQj9xnyFNHVKY5sBAUGrKEmu8qd1l8pXX2dr0yPSM+gfyxeXGeEMsQg1dDO7e+EL3nqUNHYI6kiNWqMNNHMIGpZEynLsKMnPyC3fc47D/KL0dxesaE6nrAD+CHu0wmehxvqqmk1QFjnrzyWbSTPsg4jKA83JHWfJ28F+G3qqZmAhUxYW7A9sQ97iI4RbZBjX4vr47+93Z0dJtF/Q1/AE7CqvUbo1PKX+WwUn+0r5oOaewp1hrRBwCdrQn42fLweugYxYW2Es3IAsD1cgF/hjX6nr+NzuTwaNvTyTrPgAYAM4C6aspCgGBzQ8f9LxFDoPvVKVOoIgt2pT1LLb0biJd8ooesuB4N2S8U/goVu7jcHYeLkUfmibopf03brmtmclLAZMCrlyQKIbR1dMhQ0TE57w1JNyTE26mqAa3ZXRBD6dkcPvB1MZaW3LFX+mPvv8aC6Ew5n660dlYnjvKykKjJtoRmubc1OMxLuOk3HiiA3Vf/XvrZTKQ3UXK9rluE3TRcRZc+VUNa4nNNY2NiV8wnsQsPIlDj6Wdn1GCNESRfjO8AC3ElHa0jIZnJ0kspw/SD8=
  file:
  - $TRAVIS_BUILD_DIR/mentorship-$TRAVIS_TAG.apk
  - $TRAVIS_BUILD_DIR/mentorship-$TRAVIS_TAG.qa.apk
  on:
    repo: praekeltfoundation/mentorship-droid
    tags: true
